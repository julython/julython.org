(function(){var e=function(e,t,n){this._el=$(e),this._options=n||{},this._token=t,this._setupOptions(),this._connect()};e.prototype._setupOptions=function(){this._options.maxMessages=this._options.maxMessages||100,this._totalEl=this._options.totalEl,this._total=parseInt(this._options.total)},e.prototype._reconnect=function(){var e=this;console.log("reconnecting"),jQuery.ajax({url:"/_reconnect/",success:function(t){e._token=t.token,e._connect()}})},e.prototype._connect=function(){var e=this,t=new goog.appengine.Channel(this._token),n=t.open();n.onmessage=function(t){e._newMessage(t)},n.onerror=function(e){console.log("error")},n.onclose=function(){e._reconnect()}},e.prototype.prepopulate=function(e){e=JSON.parse(e);for(var t=0;t<e.length;++t)this._newMessage(e[t])},e.prototype._newMessage=function(e){var t=this,n=this._buildMessageView(e,t);n.hide(),this._el.prepend(n),n.slideDown();while(this._el.children().length>this._options.maxMessages)this._el.children().last().remove();this._total&&$(this._totalEl).html(this._total)},e.prototype._buildMessageView=function(e,t){e.data&&typeof e.data=="string"&&(e=JSON.parse(e.data),e.commit_hash&&(t._total+=1));var n=$('<li class="message"></li>');n.append('<img src="'+e.picture_url+'" class="profile-image"/>'),n.append('<h4 class="username"><a target="_blank" href="/'+e.username+'">'+e.username+"</a></h4>"),e.project&&n.append('<p><a target="_blank" href="'+e.project+'">'+e.project+"</a></p>");if(e.url){var r=$('<p class="message-content"></p>');r.append('<a target="_blank" href="'+e.url+'">'+e.message+"</a>")}else{var r=$('<p class="message-content"></p>');r.text(e.message)}return n.append(r),n},e.prototype._startDevMessages=function(){var e=this;this._interval=window.setInterval(function(){e._newMessage({user:"Joe User",image:"/static/images/participating_button.png",message:"This is a new message!"})},1200)},window.julython||(window.julython={}),window.julython.Channel=e})();var JULY=JULY||{};ko.bindingHandlers.pageBottom={init:function(e,t,n,r){var i=t(),s=n(),o=s.callbackThreshold||1e3,u=s.callbackInterval||500;if(typeof i!="function")throw new Error("The value of the pageBottom binding must be a function");i=$.proxy(i,r);var a=$(document),f=$(window);setInterval(function(){a.height()-f.height()-f.scrollTop()<o&&i()},u)}},ko.bindingHandlers.timeago={init:function(e,t,n){var r=t();n();var i=ko.utils.unwrapObservable(r);$(e).attr("title",i),$(e).timeago()}},JULY.ViewModel=function(e){this.initialize.apply(this,arguments)},_.extend(JULY.ViewModel.prototype,{initialize:function(){}}),JULY.ViewModel.extend=Backbone.View.extend,JULY.applyBindings=function(e,t){var n=$(t);n.length>0?ko.applyBindings(e,n[0]):console.log('Binding error:  no elements found for "'+t+'"')},JULY.Commit=Backbone.Model.extend({url:"/api/v1/commit/"}),JULY.CommitCollection=Backbone.Collection.extend({model:JULY.Commit,url:function(){return"/api/v1/commit/?"+this.params()},initialize:function(e,t){this.projectId=t.projectId,this.userId=t.userId,this.limit=t.limit||20,this.offset=t.offset||0,this.total=0,this.hasMore=!1,this._pushStream=new PushStream({host:window.location.hostname,port:window.location.port,modes:"websocket|stream",urlPrefixStream:"/events/sub",urlPrefixPublisher:"/events/pub",urlPrefixWebsocket:"/events/ws"});var n=this;this._pushStream.onmessage=function(e){console.log("-- New commit from PushStream: "+e),n.unshift(e)},this._pushStream.onstatuschange=function(e){console.log("-- PushStream state changed: "+e),e===PushStream.CLOSED&&console.log("!! ERROR: PushStream was closed.")};var r=this.projectId?"project-"+this.projectId:this.userId?"user-"+this.userId:"all";console.log("-- Subscribing to PushStream channel: "+r),this._pushStream.addChannel(r),this._pushStream.connect()},params:function(){var e={limit:this.limit,offset:this.offset};return this.projectId&&(e.project=this.projectId),this.userId&&(e.user=this.userId),jQuery.param(e)},parse:function(e){return this.total=e.meta.total_count,this.offset=e.meta.offset+this.limit,this.hasMore=this.total>this.models.length,e.objects}}),JULY.CommitsView=JULY.ViewModel.extend({initialize:function(e){this.c=new JULY.CommitCollection(null,e),this.c.fetch({add:!0}),this.commits=kb.collectionObservable(this.c)},hasMore:function(){return this.commits.collection().hasMore},scrolled:function(e,t){var n=t.target;n.scrollTop>n.scrollHeight-n.offsetHeight-200&&this.fetch()},fetch:function(){this.hasMore()&&this.commits.collection().fetch({add:!0})}});if(!$)var $=null;if(!console)var console=null;var Nav=function(e,t){this._selector=e,this._el=$(e),$(window).width()<979?this._offset=0:this._offset=t||0,this._startTop=this._el.position().top,this._sectionPadding=20,this._startPadding=Number(this._el.next().css("padding-top").replace("px","")),this._height=this._el.outerHeight()};Nav.prototype.setup=function(){var e=this;this._el.find("button").each(function(){var t=$(this);t.click(function(){var t=$("h2."+this.className),n=t.position().top-e._height-e._offset-e._sectionPadding;$("html, body").animate({scrollTop:n},1100)})})},Nav.prototype.update=function(){var e=$(window);e.scrollTop()+this._offset<this._startTop?(this._el.removeClass("fixed"),this._el.next().css("padding-top",this._startPadding+"px"),this._el.css("top",""),this._el.css("width","")):(this._el.addClass("fixed"),this._el.css("top",this._offset+"px"),this._el.next().css("padding-top",this._startPadding+this._height+"px"),this._el.css("width","100%"))},function(){var e=function(e,t){this._chartId=e,this._dataUrl=t,this._chartElement=$("#"+e),this._width=this._chartElement.width(),this._height=this._chartElement.height(),this._pad={top:0,left:0,right:0,bottom:0,barX:1,barY:1},this._options={};if(!this._width||!this._height)this._width=600,this._height=400;this._chart=d3.select("#"+this._chartId).append("svg"),this._chart.attr("class","chart").attr("width",this._width).attr("height",this._height)};e.prototype.load=function(e){return this._stats=e,this},e.prototype.set=function(e,t){var n=this["_set_"+e];return n?n.apply(this,[t]):console.log("No set for option '"+e+"'."),this},e.prototype._set_xLabel=function(e){this._options.xLabel=e,this._pad.bottom+=24},e.prototype._set_title=function(e){},e.prototype._set_yLabel=function(e){this._pad.top+=20,this._options.yLabel=e},e.prototype._getChartDimensions=function(){var e=this._stats.length,t=this._width-(this._pad.left+this._pad.right)-e*this._pad.barX,n=this._height-(this._pad.bottom+this._pad.top),r=t/e,i=1;for(var s=0;s<e;s++)this._stats[s]>i&&(i=this._stats[s]);return{bars:e,barWidth:r,maxValue:i,width:t,height:n,top:this._pad.top,bottom:this._height-this._pad.bottom,left:this._pad.left,right:this._width-this._pad.right}},e.prototype.render=function(){var e=this._getChartDimensions(),n=this._chart.selectAll("rect"),r=n.data(this._stats),i=r.enter(),s=this;this._addFilters(),i.append("rect").attr("x",function(t,n){return s._pad.left+n*(e.barWidth+1)}).attr("y",function(n,r){return e.top+(e.height-t(n,e.maxValue,e.height))}).attr("width",e.barWidth).attr("height",function(n,r){return t(n,e.maxValue,e.height)});for(var o in this._options)if(this._options.hasOwnProperty(o)){var u=this["_render_"+o];u?u.apply(this,[i,this._options[o]]):console.log("No rendering option for '"+o+"'.")}return this},e.prototype._addFilters=function(){var e=this._chart.append("filter").attr("id","dropshadow");e.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",.1),e.append("feOffset").attr("dx",0).attr("dy",1).attr("result","offsetblur");var t=e.append("feMerge");t.append("feMergeNode"),t.append("feMergeNode").attr("in","SourceGraphic")},e.prototype._render_xLabel=function(e,t){var r=this._getChartDimensions(),i=this;e.append("text").attr("class","xLabel").attr("x",function(e,t){return i._pad.left+(r.barWidth+i._pad.barX)*t+r.barWidth/2}).attr("y",function(e,t){return i._pad.top+r.height+i._pad.bottom-3}).attr("width",r.barWidth).attr("text-anchor","middle").text(function(e,r){return n(t,e,r)}),this._chart.append("line").attr("class","rule").attr("y1",r.height+this._pad.top+2).attr("y2",r.height+this._pad.top+2).attr("x1",this._pad.left-2).attr("x2",this._pad.left+r.width+r.bars*this._pad.barX)},e.prototype._render_yLabel=function(e,r){var i=this._getChartDimensions(),s=this;e.append("text").attr("class","yLabel").attr("text-anchor","middle").attr("width",i.barWidth).attr("x",function(e,t){return s._pad.left+(i.barWidth+s._pad.barX)*t+i.barWidth/2}).attr("y",function(e,n){return console.log(i),s._pad.top+(i.height-t(e,i.maxValue,i.height))-5}).text(function(e,t){return n(r,e,t)})};var t=function(e,t,n){var r=e/t*n;return r},n=function(e,t,n){return $.isFunction(e)?e(t,n):e};window.Charts={BarChart:e}}();